<?xml version="1.0" encoding="utf-8" ?>
<GuidancePackage xmlns="http://schemas.microsoft.com/pag/gax-core"
    Name="EDMGuidance" 
    Caption="EDMGuidance"
    Description="No description"
    Guid="f818f372-d817-44c5-8971-3568881611aa" 
    SchemaVersion="1.0">
	<Recipes>
    
    <Recipe Name="CreateSolution">
      <xi:include href="TypeAlias.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
      <Caption>Collects information for the new EDM solution.</Caption>
      
      <Arguments>

        <!-- User Input -->
        <Argument Name="AppCompanyName">
          <Converter Type="Microsoft.Practices.RecipeFramework.Library.Converters.NamespaceStringConverter, Microsoft.Practices.RecipeFramework.Library"/>
        </Argument>
        <Argument Name="AppProjectName">
          <Converter Type="Microsoft.Practices.RecipeFramework.Library.Converters.NamespaceStringConverter, Microsoft.Practices.RecipeFramework.Library"/>
        </Argument>

        <!-- Args derived from user input -->
        <Argument Name="RttiProjectSuffix">
          <ValueProvider Type="Evaluator" Expression="Rtti" />
        </Argument>
        <Argument Name="RttiProjectName">
          <ValueProvider Type="Evaluator" Expression="$(AppCompanyName).$(AppProjectName).$(RttiProjectSuffix)">
            <MonitorArgument Name="AppCompanyName" />
            <MonitorArgument Name="AppProjectName" />
            <MonitorArgument Name="RttiProjectSuffix" />
          </ValueProvider>
        </Argument>
        <Argument Name="EntityProjectSuffix">
          <ValueProvider Type="Evaluator" Expression="Entity" />
        </Argument>
        <Argument Name="EntityProjectName">
          <ValueProvider Type="Evaluator" Expression="$(AppCompanyName).$(AppProjectName).$(EntityProjectSuffix)">
            <MonitorArgument Name="AppCompanyName" />
            <MonitorArgument Name="AppProjectName" />
            <MonitorArgument Name="EntityProjectSuffix" />
          </ValueProvider>
        </Argument>

      </Arguments>
      
      <GatheringServiceData>
        <Wizard xmlns="http://schemas.microsoft.com/pag/gax-wizards" SchemaVersion="1.0">
          <Pages>
            <Page>
              <Title>EDM Solution Information</Title>
              <Help>Enter company and project name.</Help>
              <Fields>
                <Field Label="Company Name" ValueName="AppCompanyName" />
                <Field Label="Project Name" ValueName="AppProjectName" />
              </Fields>
            </Page>
          </Pages>
        </Wizard>
      </GatheringServiceData>
      
      <Actions>
        <Action Name="GetRttiProject" Type="Microsoft.Practices.RecipeFramework.Library.Actions.GetProjectAction, Microsoft.Practices.RecipeFramework.Library">
          <Input Name="ProjectName" RecipeArgument="RttiProjectName" />
          <Output Name="Project" />
        </Action>
        <Action Name="GetEntityProject" Type="Microsoft.Practices.RecipeFramework.Library.Actions.GetProjectAction, Microsoft.Practices.RecipeFramework.Library">
          <Input Name="ProjectName" RecipeArgument="EntityProjectName" />
          <Output Name="Project" />
        </Action>
        <Action Name="AddProjectReference" Type="Microsoft.Practices.RecipeFramework.Library.Solution.Actions.AddProjectReferenceAction, Microsoft.Practices.RecipeFramework.Library">
          <Input Name="ReferringProject" ActionOutput="GetEntityProject.Project" />
          <Input Name="ReferencedProject" ActionOutput="GetRttiProject.Project" />
        </Action>
        <!--<Action Name="MoveValidators" Type="EDM.Guidance.Actions.MoveValidatorsAction, EDMGuidance">
          <Input Name="RTTIProjectName" RecipeArgument="RttiProjectName"/>
        </Action>-->
      </Actions>
    </Recipe>

    <Recipe Name="SynchronizeMetadata">
      <xi:include href="TypeAlias.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
      <Caption>Synchronizes solution with metadata file.</Caption>
      
      <Arguments>
        <Argument Name="Company" Type="System.String"/>
        <Argument Name="Project" Type="System.String"/>
      </Arguments>
      
      <Actions>
        <Action Name="SynchronizeEDM" Type="EDM.Guidance.Actions.SynchronizeMetadataAction, EDMGuidance">
          <Input Name="AppCompany" RecipeArgument="Company"/>
          <Input Name="AppProject" RecipeArgument="Project"/>
        </Action>
      </Actions>
      
    </Recipe>
    
  </Recipes>
</GuidancePackage>
